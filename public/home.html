<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SeniorCare Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@500;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Quicksand', sans-serif;
      margin: 0;
      background: linear-gradient(135deg, #f9f6ff, #ffffff);
      color: #333;
    }

    #header {
      margin-bottom: 30px;
    }

    main {
      padding: 30px 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    #clock {
      font-size: 26px;
      font-weight: bold;
      color: #5b2f91;
      margin-bottom: 30px;
      background: rgba(255, 255, 255, 0.75);
      backdrop-filter: blur(8px);
      padding: 14px 26px;
      border-radius: 16px;
      box-shadow: 0 4px 12px rgba(160, 120, 255, 0.2);
      border: 1px solid rgba(200, 180, 255, 0.4);
      animation: fadeIn 1s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .content-section {
      background: #fff;
      padding: 35px;
      border-radius: 22px;
      max-width: 800px;
      width: 100%;
      box-shadow: 6px 6px 16px rgba(170, 140, 240, 0.1),
                  -4px -4px 12px rgba(255, 255, 255, 0.6);
      transition: all 0.3s ease;
    }

    .content-section h2 {
      font-size: 26px;
      color: #4b2caf;
      margin-bottom: 20px;
    }

    .content-section h3 {
      font-size: 20px;
      color: #6239a1;
      margin-top: 30px;
    }

    .content-section p {
      font-size: 18px;
      color: #444;
      margin-top: 10px;
    }

    .content-section ul {
      list-style-type: none;
      padding: 0;
    }

    .content-section li {
      font-size: 17px;
      padding: 6px 0;
      color: #555;
    }

    footer {
      background: linear-gradient(90deg, #c9a7f4, #a3c8f6);
      color: white;
      text-align: center;
      padding: 18px;
      margin-top: 50px;
      font-size: 14px;
      border-top-left-radius: 20px;
      border-top-right-radius: 20px;
      box-shadow: 0 -4px 10px rgba(180, 140, 255, 0.15);
    }
  </style>
</head>
<body>

  <div id="header"></div>

  <main>
    <div id="clock">Loading current time...</div>

    <div id="content" class="content-section">
      <h2>Welcome to SeniorCare</h2>
      <p>Tap a button above to get started üß≠</p>
    </div>
  </main>
  <div id = "weather">
    Loading weather...
  </div>

  <footer>
    <p>¬© 2025 SeniorCare. Stay joyful, stay well üíú</p>
  </footer>
  <script src = 'home.js'></script>
  <script>
    // Load shared header
    fetch('header.html')
      .then(response => response.text())
      .then(data => {
        document.getElementById('header').innerHTML = data;
      });

    // Live clock
    function updateClock() {
      const now = new Date();
      const timeStr = now.toLocaleTimeString([], {
        hour: '2-digit',
        minute: '2-digit',
        second: '2-digit'
      });
      const dateStr = now.toLocaleDateString(undefined, {
        weekday: 'long',
        year: 'numeric',
        month: 'long',
        day: 'numeric'
      });
      document.getElementById('clock').textContent = `${dateStr}, ${timeStr}`;
    }

    setInterval(updateClock, 1000);
    updateClock();

    // Load today's data
    async function loadTodayData() {
      const now = new Date();
      const today = now.toISOString().split('T')[0];
      const contentDiv = document.getElementById('content');

      try {
        const [medsRes, appsRes] = await Promise.all([
          fetch('/api/meds'),
          fetch('/api/appointments')
        ]);

        const meds = await medsRes.json();
        const apps = await appsRes.json();

        const todayMeds = meds.filter(m => m.datetime.startsWith(today));
        const todayApps = apps.filter(a => a.time.startsWith(today));

        let html = `<h2>Today's Schedule</h2>`;

        if (todayMeds.length === 0 && todayApps.length === 0) {
          html += `<p>No medications or appointments today! üéâ</p>`;
        }

        if (todayMeds.length > 0) {
          html += `<h3>üíä Medications:</h3><ul>`;
          todayMeds.forEach(m => {
            const time = new Date(m.datetime).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            html += `<li>${m.medicine} at ${time}</li>`;
          });
          html += `</ul>`;
        }

        if (todayApps.length > 0) {
          html += `<h3>üè• Appointments:</h3><ul>`;
          todayApps.forEach(a => {
            const time = new Date(a.time).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            html += `<li>${a.clinic} - ${a.purpose} at ${time}</li>`;
          });
          html += `</ul>`;
        }

        contentDiv.innerHTML = html;

      } catch (err) {
        console.error('Error loading data:', err);
        contentDiv.innerHTML = `<h2>Error loading today's schedule</h2><p>Please try again later.</p>`;
      }
    }

    loadTodayData();
  </script>

</body>
</html>
